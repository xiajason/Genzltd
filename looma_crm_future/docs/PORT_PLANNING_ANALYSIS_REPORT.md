# 本地系统端口规划分析报告

**分析日期**: 2025年9月24日  
**版本**: v1.0  
**目标**: 为代码独立化阶段的API接口重构和数据模型重构提供端口规划基础

---

## 🎯 分析目标

在开始代码独立化之前，全面分析当前本地系统的端口使用情况，确保重构后的API接口和数据模型能够完全独立运行，避免端口冲突，为后续的独立化工作奠定基础。

---

## 📊 当前端口使用情况分析

### 原项目服务端口 (Zervigo子系统)

| 服务名称 | 端口 | 状态 | 进程ID | 说明 |
|----------|------|------|--------|------|
| **basic-server** | 8080 | ✅ 运行中 | 27176 | 基础服务 |
| **user-service** | 8081 | ✅ 运行中 | 27225 | 用户服务 |
| **resume-service** | 8082 | ✅ 运行中 | 27270 | 简历服务 |
| **company-service** | 8083 | ✅ 运行中 | 27299 | 公司服务 |
| **notification-service** | 8084 | ✅ 运行中 | 27701 | 通知服务 |
| **template-service** | 8085 | ✅ 运行中 | 27731 | 模板服务 |
| **statistics-service** | 8086 | ✅ 运行中 | 27768 | 统计服务 |
| **banner-service** | 8087 | ✅ 运行中 | 27798 | 横幅服务 |
| **dev-team-service** | 8088 | ✅ 运行中 | 27828 | 开发团队服务 |
| **job-service** | 8089 | ✅ 运行中 | 27328 | 职位服务 |
| **multi-database-service** | 8090 | ✅ 运行中 | 27667 | 多数据库服务 |

### 独立数据库端口 (LoomaCRM-Ai重构版)

| 数据库 | 端口 | 状态 | 进程ID/容器 | 部署方式 |
|--------|------|------|-------------|----------|
| **MongoDB** | 27018 | ✅ 运行中 | 57930 | 本地化 |
| **PostgreSQL** | 5434 | ✅ 运行中 | 58378 | 本地化 |
| **Redis** | 6382 | ✅ 运行中 | 58147 | 本地化 |
| **Neo4j** | 7475 | ✅ 运行中 | 59528 | 本地化 |
| **Neo4j Bolt** | 7688 | ✅ 运行中 | 59528 | 本地化 |
| **Weaviate** | 8091 | ✅ 运行中 | weaviate容器 | 容器化 |
| **Elasticsearch** | 9202 | ✅ 运行中 | elasticsearch-independent容器 | 容器化 |

### 系统服务端口

| 服务名称 | 端口 | 状态 | 进程ID | 说明 |
|----------|------|------|--------|------|
| **ControlCenter** | 5000 | ✅ 运行中 | 581 | 系统控制中心 |
| **ControlCenter** | 7000 | ✅ 运行中 | 581 | 系统控制中心 |

### 原项目数据库端口

| 数据库 | 端口 | 状态 | 进程ID | 说明 |
|--------|------|------|--------|------|
| **MongoDB (原项目)** | 27017 | ✅ 运行中 | 47651 | 原项目MongoDB |
| **PostgreSQL (原项目)** | 5432 | ✅ 运行中 | 26593 | 原项目PostgreSQL |
| **Redis (原项目)** | 6379 | ✅ 运行中 | 26086 | 原项目Redis |

---

## 🚨 端口冲突分析

### 潜在冲突点

1. **Weaviate端口冲突**
   - 原项目: 8082 (resume-service)
   - 独立版: 8091 (Weaviate容器)
   - **状态**: ✅ 无冲突 (已解决)

2. **数据库端口规划**
   - 原项目使用标准端口: 27017, 5432, 6379
   - 独立版使用独立端口: 27018, 5434, 6382
   - **状态**: ✅ 无冲突 (已规划)

### 端口使用统计

```
端口使用情况统计
├── 原项目服务端口: 11个 (8080-8089, 8090)
├── 独立数据库端口: 7个 (27018, 5434, 6382, 7475, 7688, 8091, 9202)
├── 系统服务端口: 2个 (5000, 7000)
├── 原项目数据库端口: 3个 (27017, 5432, 6379)
└── 总计使用端口: 23个
```

---

## 🎯 代码独立化端口规划

### API服务端口规划

为了确保重构后的API接口完全独立，建议使用以下端口范围：

#### 独立API服务端口规划 (9000-9099)

| 服务名称 | 端口 | 说明 | 状态 |
|----------|------|------|------|
| **looma-api-gateway** | 9000 | API网关 | 待分配 |
| **looma-user-api** | 9001 | 用户API服务 | 待分配 |
| **looma-resume-api** | 9002 | 简历API服务 | 待分配 |
| **looma-company-api** | 9003 | 公司API服务 | 待分配 |
| **looma-job-api** | 9004 | 职位API服务 | 待分配 |
| **looma-project-api** | 9005 | 项目API服务 | 待分配 |
| **looma-skill-api** | 9006 | 技能API服务 | 待分配 |
| **looma-relationship-api** | 9007 | 关系API服务 | 待分配 |
| **looma-ai-api** | 9008 | AI服务API | 待分配 |
| **looma-search-api** | 9009 | 搜索API服务 | 待分配 |

#### 独立管理服务端口规划 (9100-9199)

| 服务名称 | 端口 | 说明 | 状态 |
|----------|------|------|------|
| **looma-admin-api** | 9100 | 管理API服务 | 待分配 |
| **looma-monitor-api** | 9101 | 监控API服务 | 待分配 |
| **looma-backup-api** | 9102 | 备份API服务 | 待分配 |
| **looma-config-api** | 9103 | 配置API服务 | 待分配 |
| **looma-log-api** | 9104 | 日志API服务 | 待分配 |

#### 独立前端服务端口规划 (9200-9299)

| 服务名称 | 端口 | 说明 | 状态 |
|----------|------|------|------|
| **looma-web-frontend** | 9203 | Web前端 | 待分配 |
| **looma-admin-frontend** | 9204 | 管理前端 | 待分配 |
| **looma-mobile-api** | 9205 | 移动端API | 待分配 |

### 数据库端口规划 (已确定)

| 数据库 | 端口 | 状态 | 说明 |
|--------|------|------|------|
| **MongoDB** | 27018 | ✅ 已分配 | 独立MongoDB实例 |
| **PostgreSQL** | 5434 | ✅ 已分配 | 独立PostgreSQL实例 |
| **Redis** | 6382 | ✅ 已分配 | 独立Redis实例 |
| **Neo4j HTTP** | 7475 | ✅ 已分配 | 独立Neo4j实例 |
| **Neo4j Bolt** | 7688 | ✅ 已分配 | 独立Neo4j实例 |
| **Weaviate** | 8091 | ✅ 已分配 | 独立Weaviate实例 |
| **Elasticsearch** | 9202 | ✅ 已分配 | 独立Elasticsearch实例 |

---

## 🔧 端口管理策略

### 1. 端口分配原则

```
端口分配原则
├── 原项目端口: 8000-8099 (保留)
├── 独立API端口: 9000-9099 (新增)
├── 独立管理端口: 9100-9199 (新增)
├── 独立前端端口: 9200-9299 (新增)
├── 独立数据库端口: 27018, 5434, 6382, 7475, 7688, 8091, 9202 (已分配)
└── 系统服务端口: 5000, 7000 (保留)
```

### 2. 端口冲突预防

- **端口范围隔离**: 使用不同的端口范围避免冲突
- **端口预留**: 为未来扩展预留端口空间
- **端口文档**: 维护完整的端口分配文档
- **端口检查**: 启动前检查端口可用性

### 3. 端口监控

- **端口使用监控**: 实时监控端口使用情况
- **端口冲突告警**: 端口冲突时及时告警
- **端口健康检查**: 定期检查端口服务健康状态

---

## 📋 代码独立化实施计划

### 阶段1: API接口独立化 (9000-9099端口)

#### 1.1 API网关独立化
- **端口**: 9000
- **服务**: looma-api-gateway
- **功能**: 统一API入口，路由分发
- **依赖**: 所有独立数据库

#### 1.2 核心API服务独立化
- **用户API**: 9001 (looma-user-api)
- **简历API**: 9002 (looma-resume-api)
- **公司API**: 9003 (looma-company-api)
- **职位API**: 9004 (looma-job-api)

#### 1.3 扩展API服务独立化
- **项目API**: 9005 (looma-project-api)
- **技能API**: 9006 (looma-skill-api)
- **关系API**: 9007 (looma-relationship-api)
- **AI API**: 9008 (looma-ai-api)
- **搜索API**: 9009 (looma-search-api)

### 阶段2: 管理服务独立化 (9100-9199端口)

#### 2.1 管理API服务
- **管理API**: 9100 (looma-admin-api)
- **监控API**: 9101 (looma-monitor-api)
- **备份API**: 9102 (looma-backup-api)
- **配置API**: 9103 (looma-config-api)
- **日志API**: 9104 (looma-log-api)

### 阶段3: 前端服务独立化 (9200-9299端口)

#### 3.1 前端服务
- **Web前端**: 9203 (looma-web-frontend)
- **管理前端**: 9204 (looma-admin-frontend)
- **移动端API**: 9205 (looma-mobile-api)

---

## 🚀 实施建议

### 1. 立即行动项

1. **端口预留**: 立即预留9000-9299端口范围
2. **端口检查**: 检查9000-9299端口范围是否可用
3. **配置更新**: 更新配置文件中的端口设置
4. **文档更新**: 更新端口分配文档

### 2. 开发准备

1. **API网关开发**: 开始开发looma-api-gateway (端口9000)
2. **核心API开发**: 并行开发核心API服务
3. **数据库连接**: 配置API服务连接独立数据库
4. **测试环境**: 建立独立的测试环境

### 3. 部署准备

1. **Docker配置**: 为每个API服务创建Docker配置
2. **负载均衡**: 配置API服务的负载均衡
3. **监控配置**: 配置API服务的监控
4. **日志配置**: 配置API服务的日志收集

---

## 📊 端口使用预测

### 当前端口使用
```
当前端口使用情况
├── 原项目服务: 11个端口
├── 独立数据库: 7个端口
├── 系统服务: 2个端口
├── 原项目数据库: 3个端口
└── 总计: 23个端口
```

### 独立化后端口使用
```
独立化后端口使用情况
├── 原项目服务: 11个端口 (保留)
├── 独立API服务: 10个端口 (新增)
├── 独立管理服务: 5个端口 (新增)
├── 独立前端服务: 3个端口 (新增)
├── 独立数据库: 7个端口 (已分配)
├── 系统服务: 2个端口 (保留)
└── 总计: 38个端口
```

### 端口使用增长
- **当前使用**: 23个端口
- **独立化后**: 38个端口
- **增长数量**: 15个端口
- **增长比例**: 65%

---

## ⚠️ 风险与缓解措施

### 风险1: 端口冲突
- **风险**: 新分配的端口与现有服务冲突
- **缓解**: 提前检查端口可用性，使用端口范围隔离

### 风险2: 端口管理复杂
- **风险**: 端口数量增加，管理复杂度提升
- **缓解**: 建立端口管理文档，使用自动化工具

### 风险3: 服务发现困难
- **风险**: 端口数量多，服务发现和配置困难
- **缓解**: 使用服务注册中心，统一配置管理

### 风险4: 网络性能影响
- **风险**: 端口数量多可能影响网络性能
- **缓解**: 使用负载均衡，优化网络配置

---

## 🎯 总结

### 当前状况
- **端口使用**: 23个端口正在使用
- **端口冲突**: 无严重冲突，Weaviate端口已解决
- **端口规划**: 独立数据库端口已规划完成

### 独立化规划
- **API服务端口**: 9000-9099 (10个端口)
- **管理服务端口**: 9100-9199 (5个端口)
- **前端服务端口**: 9200-9299 (3个端口)
- **总计新增**: 18个端口

### 实施建议
1. **立即预留**: 9000-9299端口范围
2. **并行开发**: API网关和核心API服务
3. **渐进迁移**: 逐步从原项目迁移到独立服务
4. **完整测试**: 每个服务独立测试和集成测试

### 预期效果
- **完全独立**: API接口和数据模型完全独立
- **无冲突**: 端口规划清晰，无冲突风险
- **可扩展**: 为未来扩展预留充足端口空间
- **易管理**: 端口分配有序，便于管理

---

**报告版本**: v1.0  
**创建日期**: 2025年9月24日  
**维护者**: AI Assistant  
**状态**: 建议采纳
