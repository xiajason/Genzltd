# JobFirst å®‰å…¨å…³é—­æ“ä½œæŒ‡å—

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-09-12  
**é€‚ç”¨ç‰ˆæœ¬**: JobFirst Basic v3.1.1

## ğŸ¯ æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜äº†å¦‚ä½•å®‰å…¨åœ°å…³é—­JobFirstç³»ç»Ÿï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§å’Œç³»ç»Ÿç¨³å®šæ€§ã€‚å®‰å…¨å…³é—­è„šæœ¬æä¾›äº†å®Œæ•´çš„æ•°æ®ä¿æŠ¤æœºåˆ¶å’Œä¼˜é›…å…³é—­æµç¨‹ã€‚

## ğŸš¨ é‡è¦æé†’

### âš ï¸ æ•°æ®å®‰å…¨è­¦å‘Š
- **å§‹ç»ˆä½¿ç”¨å®‰å…¨å…³é—­è„šæœ¬**ï¼Œé¿å…ç›´æ¥ä½¿ç”¨ `kill` å‘½ä»¤
- **å…³é—­å‰ä¼šè‡ªåŠ¨å¤‡ä»½**å…³é”®æ•°æ®ï¼Œç¡®ä¿æ•°æ®å®‰å…¨
- **æ•°æ®åº“å®Œæ•´æ€§ç¡®ä¿**ï¼Œé˜²æ­¢æ•°æ®æŸå
- **ä¼˜é›…å…³é—­æœºåˆ¶**ï¼Œé¿å…è¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢

### ğŸ”’ å®‰å…¨ç‰¹æ€§
- âœ… è‡ªåŠ¨æ•°æ®å¤‡ä»½
- âœ… æ•°æ®åº“å®Œæ•´æ€§ç¡®ä¿
- âœ… ä¼˜é›…å…³é—­æœºåˆ¶
- âœ… è¶…æ—¶ä¿æŠ¤
- âœ… æœåŠ¡æ³¨é”€
- âœ… ä¸´æ—¶æ–‡ä»¶æ¸…ç†

## ğŸ“‹ å®‰å…¨å…³é—­è„šæœ¬åŠŸèƒ½

### æ ¸å¿ƒåŠŸèƒ½
```bash
./scripts/maintenance/safe-shutdown.sh [é€‰é¡¹]
```

#### ä¸»è¦åŠŸèƒ½
1. **æœåŠ¡çŠ¶æ€æ£€æŸ¥** - æ£€æŸ¥æ‰€æœ‰è¿è¡Œä¸­çš„æœåŠ¡
2. **å…³é”®æ•°æ®å¤‡ä»½** - è‡ªåŠ¨å¤‡ä»½MySQLã€Redisã€é…ç½®æ–‡ä»¶
3. **æ•°æ®åº“å®Œæ•´æ€§ç¡®ä¿** - åˆ·æ–°æ•°æ®åˆ°ç£ç›˜
4. **ä¼˜é›…å…³é—­å¾®æœåŠ¡** - æŒ‰æ­£ç¡®é¡ºåºå…³é—­æœåŠ¡
5. **ConsulæœåŠ¡æ³¨é”€** - ä»æœåŠ¡å‘ç°ä¸­æ³¨é”€
6. **ä¸´æ—¶æ–‡ä»¶æ¸…ç†** - æ¸…ç†PIDæ–‡ä»¶å’Œä¸´æ—¶æ–‡ä»¶
7. **åŸºç¡€è®¾æ–½æœåŠ¡åœæ­¢** - åœæ­¢Nginxã€Consulç­‰
8. **å…³é—­éªŒè¯** - éªŒè¯æ‰€æœ‰æœåŠ¡å·²æ­£ç¡®å…³é—­
9. **ç”Ÿæˆå…³é—­æŠ¥å‘Š** - è¯¦ç»†çš„å…³é—­æŠ¥å‘Š

## ğŸ› ï¸ ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ç”¨æ³•

#### å®‰å…¨å…³é—­ï¼ˆä¿ç•™æ•°æ®åº“ï¼‰
```bash
# å…³é—­æ‰€æœ‰å¾®æœåŠ¡ï¼Œä½†ä¿ç•™æ•°æ®åº“è¿è¡Œ
./scripts/maintenance/safe-shutdown.sh
```

#### å®Œå…¨å…³é—­ï¼ˆåŒ…æ‹¬æ•°æ®åº“ï¼‰
```bash
# å…³é—­æ‰€æœ‰æœåŠ¡ï¼ŒåŒ…æ‹¬æ•°æ®åº“
./scripts/maintenance/safe-shutdown.sh --stop-databases
```

#### æŸ¥çœ‹å¸®åŠ©
```bash
# æ˜¾ç¤ºè¯¦ç»†å¸®åŠ©ä¿¡æ¯
./scripts/maintenance/safe-shutdown.sh --help
```

### 2. å…³é—­æµç¨‹è¯¦è§£

#### ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡é˜¶æ®µ
```bash
[STEP] æ£€æŸ¥å½“å‰æœåŠ¡çŠ¶æ€...
[INFO] âœ… api_gateway æ­£åœ¨è¿è¡Œ (ç«¯å£: 8080, PID: 12345)
[INFO] âœ… user_service æ­£åœ¨è¿è¡Œ (ç«¯å£: 8081, PID: 12346)
[INFO] âœ… MySQL æ­£åœ¨è¿è¡Œ
[INFO] âœ… Redis æ­£åœ¨è¿è¡Œ
[INFO] âœ… Consul æ­£åœ¨è¿è¡Œ
```

#### ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®å¤‡ä»½
```bash
[STEP] æ‰§è¡Œå…³é”®æ•°æ®å¤‡ä»½...
[INFO] å¤‡ä»½MySQLæ•°æ®åº“...
[SUCCESS] MySQLæ•°æ®åº“å¤‡ä»½å®Œæˆ: /backups/20250912_183500/jobfirst_backup.sql
[INFO] å¤‡ä»½Redisæ•°æ®...
[SUCCESS] Redisæ•°æ®å¤‡ä»½å®Œæˆ: /backups/20250912_183500/redis_backup.rdb
[INFO] å¤‡ä»½é…ç½®æ–‡ä»¶...
[SUCCESS] é…ç½®æ–‡ä»¶å¤‡ä»½å®Œæˆ
[INFO] å¤‡ä»½é‡è¦æ—¥å¿—æ–‡ä»¶...
[SUCCESS] æ—¥å¿—æ–‡ä»¶å¤‡ä»½å®Œæˆ
```

#### ç¬¬ä¸‰é˜¶æ®µï¼šæ•°æ®å®Œæ•´æ€§ç¡®ä¿
```bash
[STEP] ç¡®ä¿æ•°æ®åº“æ•°æ®å®Œæ•´æ€§...
[INFO] åˆ·æ–°MySQLæ•°æ®åˆ°ç£ç›˜...
[SUCCESS] MySQLæ•°æ®å®Œæ•´æ€§ç¡®ä¿å®Œæˆ
[INFO] ä¿å­˜Redisæ•°æ®åˆ°ç£ç›˜...
[SUCCESS] Redisæ•°æ®ä¿å­˜å®Œæˆ
```

#### ç¬¬å››é˜¶æ®µï¼šä¼˜é›…å…³é—­æœåŠ¡
```bash
[STEP] ä¼˜é›…å…³é—­å¾®æœåŠ¡...
[INFO] ä¼˜é›…å…³é—­ ai_service (PID: 12350)...
[SUCCESS] ai_service å·²å…³é—­
[INFO] ä¼˜é›…å…³é—­ dev_team_service (PID: 12349)...
[SUCCESS] dev_team_service å·²å…³é—­
...
```

#### ç¬¬äº”é˜¶æ®µï¼šæœåŠ¡æ³¨é”€å’Œæ¸…ç†
```bash
[STEP] ä»Consulæ³¨é”€æœåŠ¡...
[INFO] æ³¨é”€æœåŠ¡: ai-service-8206
[SUCCESS] âœ… æœåŠ¡ ai-service-8206 æ³¨é”€æˆåŠŸ
[INFO] æ³¨é”€æœåŠ¡: dev-team-service-8088
[SUCCESS] âœ… æœåŠ¡ dev-team-service-8088 æ³¨é”€æˆåŠŸ
...
```

#### ç¬¬å…­é˜¶æ®µï¼šéªŒè¯å’ŒæŠ¥å‘Š
```bash
[STEP] éªŒè¯å…³é—­ç»“æœ...
[SUCCESS] æ‰€æœ‰å¾®æœåŠ¡å·²æˆåŠŸå…³é—­
[STEP] ç”Ÿæˆå…³é—­æŠ¥å‘Š...
[SUCCESS] å…³é—­æŠ¥å‘Šå·²ç”Ÿæˆ: /logs/shutdown_report_20250912_183500.txt
```

## ğŸ“Š æ•°æ®å¤‡ä»½è¯¦æƒ…

### è‡ªåŠ¨å¤‡ä»½å†…å®¹

#### 1. æ•°æ®åº“å¤‡ä»½
```bash
# MySQLæ•°æ®åº“å¤‡ä»½
mysqldump -u root jobfirst > backup/jobfirst_backup.sql

# Redisæ•°æ®å¤‡ä»½
redis-cli --rdb backup/redis_backup.rdb
```

#### 2. é…ç½®æ–‡ä»¶å¤‡ä»½
```bash
# å¤‡ä»½é…ç½®æ–‡ä»¶
cp -r configs/ backup/configs_backup/
cp -r nginx/ backup/nginx_backup/
```

#### 3. æ—¥å¿—æ–‡ä»¶å¤‡ä»½
```bash
# å¤‡ä»½é‡è¦æ—¥å¿—æ–‡ä»¶
find logs/ -name "*.log" -mtime -1 -exec cp {} backup/ \;
```

#### 4. å¤‡ä»½æ¸…å•
```bash
# è‡ªåŠ¨ç”Ÿæˆå¤‡ä»½æ¸…å•
cat > backup/backup_manifest.txt << EOF
JobFirst æ•°æ®å¤‡ä»½æ¸…å•
å¤‡ä»½æ—¶é—´: 2025-09-12 18:35:00
å¤‡ä»½è·¯å¾„: /backups/20250912_183500

åŒ…å«å†…å®¹:
- MySQLæ•°æ®åº“: jobfirst_backup.sql
- Redisæ•°æ®: redis_backup.rdb
- é…ç½®æ–‡ä»¶: configs_backup/, nginx_backup/
- æ—¥å¿—æ–‡ä»¶: *.log

æ¢å¤å‘½ä»¤:
- MySQLæ¢å¤: mysql -u root jobfirst < jobfirst_backup.sql
- Redisæ¢å¤: redis-cli --pipe < redis_backup.rdb
EOF
```

## ğŸ”„ æ•°æ®æ¢å¤æŒ‡å—

### MySQLæ•°æ®æ¢å¤
```bash
# æ¢å¤MySQLæ•°æ®åº“
mysql -u root jobfirst < /backups/20250912_183500/jobfirst_backup.sql
```

### Redisæ•°æ®æ¢å¤
```bash
# åœæ­¢RedisæœåŠ¡
brew services stop redis

# æ¢å¤Redisæ•°æ®
redis-cli --pipe < /backups/20250912_183500/redis_backup.rdb

# å¯åŠ¨RedisæœåŠ¡
brew services start redis
```

### é…ç½®æ–‡ä»¶æ¢å¤
```bash
# æ¢å¤é…ç½®æ–‡ä»¶
cp -r /backups/20250912_183500/configs_backup/* configs/
cp -r /backups/20250912_183500/nginx_backup/* nginx/
```

## ğŸ“ˆ å…³é—­æŠ¥å‘Šç¤ºä¾‹

### å…³é—­æŠ¥å‘Šå†…å®¹
```bash
==========================================
JobFirst å®‰å…¨å…³é—­æŠ¥å‘Š
==========================================
å…³é—­æ—¶é—´: 2025-09-12 18:35:00
å…³é—­è„šæœ¬: ./scripts/maintenance/safe-shutdown.sh
å…³é—­æ—¥å¿—: /logs/safe-shutdown.log

å…³é—­æ­¥éª¤:
âœ… æœåŠ¡çŠ¶æ€æ£€æŸ¥
âœ… å…³é”®æ•°æ®å¤‡ä»½
âœ… å¾®æœåŠ¡ä¼˜é›…å…³é—­
âœ… ConsulæœåŠ¡æ³¨é”€
âœ… æ•°æ®åº“å®Œæ•´æ€§ç¡®ä¿
âœ… ä¸´æ—¶æ–‡ä»¶æ¸…ç†
âœ… åŸºç¡€è®¾æ–½æœåŠ¡åœæ­¢

æ•°æ®å®‰å…¨æªæ–½:
- MySQLæ•°æ®åº“å¤‡ä»½
- Redisæ•°æ®å¤‡ä»½
- é…ç½®æ–‡ä»¶å¤‡ä»½
- æ—¥å¿—æ–‡ä»¶å¤‡ä»½
- æ•°æ®åº“å®Œæ•´æ€§ç¡®ä¿

å…³é—­çŠ¶æ€:
âœ… æ‰€æœ‰æœåŠ¡å·²æˆåŠŸå…³é—­

å¤‡ä»½ä½ç½®: /backups/20250912_183500

æ¢å¤å»ºè®®:
- å¦‚éœ€æ¢å¤æ•°æ®ï¼Œè¯·ä½¿ç”¨å¤‡ä»½æ–‡ä»¶
- é‡æ–°å¯åŠ¨æœåŠ¡è¯·ä½¿ç”¨å¯åŠ¨è„šæœ¬
- æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ä»¥è·å–è¯¦ç»†ä¿¡æ¯

==========================================
```

## ğŸš€ å®‰å…¨å¯åŠ¨è„šæœ¬

### å¯¹åº”å¯åŠ¨è„šæœ¬
```bash
# å®‰å…¨å¯åŠ¨æ‰€æœ‰æœåŠ¡
./scripts/maintenance/safe-startup.sh

# å®‰å…¨å¯åŠ¨åŒ…æ‹¬å‰ç«¯
./scripts/maintenance/safe-startup.sh --with-frontend
```

### å¯åŠ¨é¡ºåº
1. **åŸºç¡€è®¾æ–½æœåŠ¡** (MySQL, Redis, Consul)
2. **æ ¸å¿ƒå¾®æœåŠ¡** (API Gateway, User Service, Resume Service)
3. **ä¸šåŠ¡å¾®æœåŠ¡** (Company Service, Notification Service)
4. **é‡æ„å¾®æœåŠ¡** (Template, Statistics, Banner, Dev Team)
5. **AIæœåŠ¡**

## âš¡ å¿«é€Ÿæ“ä½œæŒ‡å—

### æ—¥å¸¸æ“ä½œ
```bash
# 1. å®‰å…¨å…³é—­ç³»ç»Ÿ
./scripts/maintenance/safe-shutdown.sh

# 2. ç­‰å¾…ç¡®è®¤åå…³é—­æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰
# ç³»ç»Ÿä¼šè¯¢é—®æ˜¯å¦å…³é—­æ•°æ®åº“æœåŠ¡

# 3. é‡æ–°å¯åŠ¨ç³»ç»Ÿ
./scripts/maintenance/safe-startup.sh
```

### ç´§æ€¥æƒ…å†µ
```bash
# å¦‚æœéœ€è¦å¼ºåˆ¶å…³é—­ï¼ˆä¸æ¨èï¼‰
# 1. å…ˆå°è¯•ä¼˜é›…å…³é—­
./scripts/maintenance/safe-shutdown.sh

# 2. å¦‚æœå¤±è´¥ï¼Œæ£€æŸ¥è¿›ç¨‹
ps aux | grep -E "(go run|python|node)"

# 3. æ‰‹åŠ¨æ¸…ç†ï¼ˆæœ€åæ‰‹æ®µï¼‰
kill -9 <PID>
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ç«¯å£è¢«å ç”¨
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -Pi :8080 -sTCP:LISTEN

# å¼ºåˆ¶æ¸…ç†ç«¯å£
kill -9 $(lsof -Pi :8080 -sTCP:LISTEN -t)
```

#### 2. æœåŠ¡æ— æ³•å…³é—­
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
./scripts/maintenance/safe-shutdown.sh

# æ‰‹åŠ¨å…³é—­ç‰¹å®šæœåŠ¡
kill -TERM <PID>
```

#### 3. æ•°æ®åº“è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
brew services list | grep mysql
brew services list | grep redis

# é‡å¯æ•°æ®åº“æœåŠ¡
brew services restart mysql
brew services restart redis
```

#### 4. å¤‡ä»½æ–‡ä»¶é—®é¢˜
```bash
# æ£€æŸ¥å¤‡ä»½ç›®å½•
ls -la /backups/

# æ£€æŸ¥å¤‡ä»½æ–‡ä»¶å¤§å°
du -sh /backups/*/
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. å®šæœŸå¤‡ä»½
```bash
# å»ºè®®æ¯å¤©è‡ªåŠ¨å¤‡ä»½
0 2 * * * /path/to/safe-shutdown.sh --backup-only
```

### 2. ç›‘æ§å…³é—­æ—¥å¿—
```bash
# æŸ¥çœ‹å…³é—­æ—¥å¿—
tail -f logs/safe-shutdown.log

# æ£€æŸ¥å…³é—­æŠ¥å‘Š
cat logs/shutdown_report_*.txt
```

### 3. éªŒè¯æ•°æ®å®Œæ•´æ€§
```bash
# å¯åŠ¨åéªŒè¯æ•°æ®
./scripts/maintenance/safe-startup.sh
./backend/pkg/jobfirst-core/superadmin/zervigo_standalone full
```

### 4. å®šæœŸæ¸…ç†å¤‡ä»½
```bash
# ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find /backups/ -type d -mtime +7 -exec rm -rf {} \;
```

## ğŸ‰ æ€»ç»“

### âœ… å®‰å…¨å…³é—­çš„ä¼˜åŠ¿
- **æ•°æ®å®‰å…¨**: è‡ªåŠ¨å¤‡ä»½æ‰€æœ‰å…³é”®æ•°æ®
- **ä¼˜é›…å…³é—­**: æŒ‰æ­£ç¡®é¡ºåºå…³é—­æœåŠ¡
- **å®Œæ•´æ€§ç¡®ä¿**: æ•°æ®åº“æ•°æ®å®Œæ•´æ€§ä¿æŠ¤
- **æœåŠ¡æ³¨é”€**: ä»Consulæ­£ç¡®æ³¨é”€æœåŠ¡
- **è¯¦ç»†æ—¥å¿—**: å®Œæ•´çš„å…³é—­è¿‡ç¨‹è®°å½•

### ğŸ”’ æ•°æ®ä¿æŠ¤æœºåˆ¶
- **å¤šå±‚å¤‡ä»½**: MySQLã€Redisã€é…ç½®æ–‡ä»¶ã€æ—¥å¿—
- **å®Œæ•´æ€§éªŒè¯**: å…³é—­å‰ç¡®ä¿æ•°æ®å®Œæ•´æ€§
- **æ¢å¤æœºåˆ¶**: æä¾›å®Œæ•´çš„æ•°æ®æ¢å¤æ–¹æ¡ˆ
- **ç›‘æ§æŠ¥å‘Š**: è¯¦ç»†çš„å…³é—­çŠ¶æ€æŠ¥å‘Š

**ä½¿ç”¨å®‰å…¨å…³é—­è„šæœ¬ï¼Œç¡®ä¿æ‚¨çš„JobFirstç³»ç»Ÿæ•°æ®å®‰å…¨å’Œç³»ç»Ÿç¨³å®šæ€§ï¼** ğŸ†

---

**æ–‡æ¡£ç»´æŠ¤**: AI Assistant  
**æœ€åæ›´æ–°**: 2025-09-12  
**ç‰ˆæœ¬**: v1.0
