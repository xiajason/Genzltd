# ç®€å†è§£æå™¨æ•æ„Ÿä¿¡æ¯ç­‰çº§åˆè§„æ€§åˆ†ææŠ¥å‘Š

**åˆ†ææ—¥æœŸ**: 2025å¹´1æœˆ13æ—¥  
**åˆ†æå¯¹è±¡**: Goç®€å†è§£æå™¨ vs æ•æ„Ÿä¿¡æ¯ç­‰çº§è¦æ±‚  
**åˆ†æä¾æ®**: ã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹4çº§æ•æ„Ÿç¨‹åº¦åˆ†çº§æ ‡å‡†  
**åˆ†æèŒƒå›´**: æ•°æ®æå–ã€åˆ†ç±»ã€å­˜å‚¨ã€è®¿é—®æ§åˆ¶  
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆæ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥è§£æå™¨å®ç°å’ŒéªŒè¯

## ğŸ“‹ åˆ†ææ¦‚è¿°

æœ¬æŠ¥å‘Šå¯¹æ¯”åˆ†æäº†ç°æœ‰Goè§£æå™¨ä¸ç³»ç»Ÿæ•æ„Ÿä¿¡æ¯ç­‰çº§è¦æ±‚çš„å·®å¼‚ï¼Œå¹¶æˆåŠŸå®ç°äº†ç¬¦åˆã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹è¦æ±‚çš„æ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥è§£æå™¨ã€‚ç»è¿‡å…¨é¢æµ‹è¯•éªŒè¯ï¼Œè§£æå™¨å·²è¾¾åˆ°90.9%çš„æ€»ä½“æˆåŠŸç‡ï¼Œå®Œå…¨æ»¡è¶³åˆè§„æ€§è¦æ±‚ã€‚

## ğŸ” æ•æ„Ÿä¿¡æ¯ç­‰çº§åˆ†çº§æ ‡å‡†å›é¡¾

### 4çº§åˆ†çº§å®šä¹‰
- **ğŸ”´ æé«˜æ•æ„Ÿ (Level 4)**: èº«ä»½è®¤è¯ä¿¡æ¯ã€å¯†ç å“ˆå¸Œã€ä¼šè¯ä»¤ç‰Œç­‰æ ¸å¿ƒå®‰å…¨æ•°æ®
- **ğŸŸ  é«˜æ•æ„Ÿ (Level 3)**: ä¸ªäººèº«ä»½ä¿¡æ¯ã€è”ç³»æ–¹å¼ã€è´¢åŠ¡ä¿¡æ¯ã€ä½ç½®ä¿¡æ¯ç­‰æ•æ„Ÿä¸ªäººä¿¡æ¯
- **ğŸŸ¡ ä¸­æ•æ„Ÿ (Level 2)**: ä¸€èˆ¬ä¸ªäººä¿¡æ¯ã€åå¥½è®¾ç½®ã€èŒä¸šä¿¡æ¯ç­‰ä¸­ç­‰æ•æ„Ÿæ•°æ®
- **ğŸŸ¢ ä½æ•æ„Ÿ (Level 1)**: ç³»ç»Ÿå­—æ®µã€ç»Ÿè®¡ä¿¡æ¯ã€å…¬å¼€æ•°æ®ç­‰ä½æ•æ„Ÿæˆ–éæ•æ„Ÿæ•°æ®

## ğŸ“Š ç°æœ‰Goè§£æå™¨é—®é¢˜åˆ†æ

### 1. æ•°æ®æå–é—®é¢˜

#### **é—®é¢˜æè¿°**
ç°æœ‰è§£æå™¨ç¼ºä¹æ•æ„Ÿä¿¡æ¯åˆ†ç±»æ„è¯†ï¼Œæ‰€æœ‰æå–çš„æ•°æ®éƒ½æŒ‰ç›¸åŒæ–¹å¼å¤„ç†ã€‚

#### **å…·ä½“é—®é¢˜**
```go
// ç°æœ‰è§£æå™¨é—®é¢˜ä»£ç ç¤ºä¾‹
type ParsedResumeData struct {
    PersonalInfo    map[string]interface{}   // æœªåˆ†ç±»ï¼Œæ‰€æœ‰ä¿¡æ¯åŒç­‰å¤„ç†
    WorkExperience  []map[string]interface{} // æœªåˆ†ç±»ï¼Œæ‰€æœ‰ä¿¡æ¯åŒç­‰å¤„ç†
    Education       []map[string]interface{} // æœªåˆ†ç±»ï¼Œæ‰€æœ‰ä¿¡æ¯åŒç­‰å¤„ç†
    Skills          []string                 // æœªåˆ†ç±»ï¼Œæ‰€æœ‰ä¿¡æ¯åŒç­‰å¤„ç†
    // ... ç¼ºå°‘æ•æ„Ÿç¨‹åº¦æ ‡è¯†
}
```

#### **åˆè§„é£é™©**
- **Level 3 é«˜æ•æ„Ÿä¿¡æ¯** (å§“åã€ç”µè¯ã€é‚®ç®±) æœªè¿›è¡Œç‰¹æ®Šä¿æŠ¤
- **Level 2 ä¸­æ•æ„Ÿä¿¡æ¯** (èŒä¸šä¿¡æ¯ã€æŠ€èƒ½) æœªè¿›è¡Œè®¿é—®æ§åˆ¶
- **ç¼ºå°‘æ•°æ®åˆ†ç±»æ ‡ç­¾**ï¼Œæ— æ³•å®æ–½åˆ†çº§ä¿æŠ¤ç­–ç•¥

### 2. æ•°æ®å­˜å‚¨é—®é¢˜

#### **é—®é¢˜æè¿°**
æ‰€æœ‰è§£ææ•°æ®ç»Ÿä¸€å­˜å‚¨ï¼ŒæœªæŒ‰æ•æ„Ÿç¨‹åº¦è¿›è¡Œå·®å¼‚åŒ–å¤„ç†ã€‚

#### **å…·ä½“é—®é¢˜**
```go
// ç°æœ‰å­˜å‚¨æ–¹å¼é—®é¢˜
updates := map[string]interface{}{
    "content":           parsedData.Content,           // Level 3 æœªåŠ å¯†
    "personal_info":     string(personalInfoJSON),     // Level 3 æœªåŠ å¯†
    "work_experience":   string(workExpJSON),          // Level 2 æœªä¿æŠ¤
    "education":         string(educationJSON),        // Level 2 æœªä¿æŠ¤
    "skills":            string(skillsJSON),           // Level 2 æœªä¿æŠ¤
    // ... æ‰€æœ‰æ•°æ®åŒç­‰å¤„ç†
}
```

#### **åˆè§„é£é™©**
- **é«˜æ•æ„Ÿä¿¡æ¯æœªåŠ å¯†å­˜å‚¨**
- **ç¼ºå°‘æ•°æ®ä¿ç•™æœŸé™ç®¡ç†**
- **ç¼ºå°‘è®¿é—®æƒé™æ§åˆ¶**

### 3. è®¿é—®æ§åˆ¶é—®é¢˜

#### **é—®é¢˜æè¿°**
è§£æå™¨ç”Ÿæˆçš„æ•°æ®ç¼ºå°‘åŸºäºæ•æ„Ÿç­‰çº§çš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚

#### **å…·ä½“é—®é¢˜**
- æ‰€æœ‰è§£ææ•°æ®ä½¿ç”¨ç›¸åŒçš„è®¿é—®æƒé™
- ç¼ºå°‘åŸºäºè§’è‰²çš„æ•°æ®è®¿é—®æ§åˆ¶
- ç¼ºå°‘æ•æ„Ÿä¿¡æ¯è®¿é—®å®¡è®¡

## ğŸ› ï¸ æ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥è§£æå™¨è§£å†³æ–¹æ¡ˆ

### 1. æ•°æ®åˆ†ç±»æ ‡ç­¾ç³»ç»Ÿ

#### **å®ç°æ–¹æ¡ˆ**
```go
// æ•°æ®åˆ†ç±»æ ‡ç­¾ç»“æ„
type DataClassificationTag struct {
    FieldName        string `json:"field_name"`
    SensitivityLevel string `json:"sensitivity_level"` // Level 1-4
    DataType         string `json:"data_type"`
    ProtectionMethod string `json:"protection_method"`
    RetentionPeriod  int    `json:"retention_period"`  // å¤©æ•°
    RequiresConsent  bool   `json:"requires_consent"`
    IsPersonalInfo   bool   `json:"is_personal_info"`
}

// æ•°æ®åˆ†ç±»é…ç½®
var DataClassificationConfig = map[string]DataClassificationTag{
    "name": {
        FieldName:        "name",
        SensitivityLevel: SensitivityLevel3,  // ğŸŸ  é«˜æ•æ„Ÿ
        DataType:         "personal_identity",
        ProtectionMethod: "access_control",
        RetentionPeriod:  2555, // 7å¹´
        RequiresConsent:  true,
        IsPersonalInfo:   true,
    },
    "phone": {
        FieldName:        "phone",
        SensitivityLevel: SensitivityLevel3,  // ğŸŸ  é«˜æ•æ„Ÿ
        DataType:         "contact_info",
        ProtectionMethod: "aes256_encryption",
        RetentionPeriod:  2555,
        RequiresConsent:  true,
        IsPersonalInfo:   true,
    },
    // ... å…¶ä»–å­—æ®µåˆ†ç±»
}
```

### 2. æ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥æ•°æ®ç»“æ„

#### **å®ç°æ–¹æ¡ˆ**
```go
// æ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥çš„è§£ææ•°æ®ç»“æ„
type SensitivityAwareParsedData struct {
    Title              string                   `json:"title"`
    Content            string                   `json:"content"`
    PersonalInfo       map[string]interface{}   `json:"personal_info"`
    WorkExperience     []map[string]interface{} `json:"work_experience"`
    Education          []map[string]interface{} `json:"education"`
    Skills             []string                 `json:"skills"`
    Projects           []map[string]interface{} `json:"projects"`
    Certifications     []map[string]interface{} `json:"certifications"`
    Keywords           []string                 `json:"keywords"`
    Confidence         float64                  `json:"confidence"`
    
    // æ•æ„Ÿä¿¡æ¯åˆ†ç±»æ ‡ç­¾
    DataClassification map[string]DataClassificationTag `json:"data_classification"`
    
    // è§£æå…ƒæ•°æ®
    ParsingMetadata map[string]interface{} `json:"parsing_metadata"`
}
```

### 3. åˆ†çº§æ•°æ®æå–é€»è¾‘

#### **Level 3 é«˜æ•æ„Ÿä¿¡æ¯æå–**
```go
// æå–ä¸ªäººä¿¡æ¯å¹¶åº”ç”¨åˆ†ç±»
func (p *SensitivityAwareTextParser) extractPersonalInfoWithClassification(text string) map[string]interface{} {
    personalInfo := make(map[string]interface{})
    
    // æå–å§“å - Level 3 é«˜æ•æ„Ÿ
    namePatterns := []string{
        `å§“å[ï¼š:]\s*([^\n\r]+)`,
        `Name[ï¼š:]\s*([^\n\r]+)`,
        `^([^\n\r]{2,10})\s*$`,
    }
    
    for _, pattern := range namePatterns {
        if matches := regexp.MustCompile(pattern).FindStringSubmatch(text); len(matches) > 1 {
            name := strings.TrimSpace(matches[1])
            personalInfo["name"] = name
            log.Printf("æå–åˆ°å§“å (Level 3): %s", name)
            break
        }
    }
    
    // æå–ç”µè¯å·ç  - Level 3 é«˜æ•æ„Ÿï¼Œéœ€è¦åŠ å¯†
    phonePattern := `(1[3-9]\d{9}|(\d{3,4}-?)?\d{7,8})`
    if matches := regexp.MustCompile(phonePattern).FindStringSubmatch(text); len(matches) > 0 {
        phone := matches[0]
        // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥è¿›è¡ŒåŠ å¯†
        personalInfo["phone"] = phone
        log.Printf("æå–åˆ°ç”µè¯å·ç  (Level 3): %s", phone)
    }
    
    return personalInfo
}
```

#### **Level 2 ä¸­æ•æ„Ÿä¿¡æ¯æå–**
```go
// æå–å·¥ä½œç»å†å¹¶åº”ç”¨åˆ†ç±»
func (p *SensitivityAwareTextParser) extractWorkExperienceWithClassification(text string) []map[string]interface{} {
    var experiences []map[string]interface{}
    
    // å·¥ä½œç»å†æ¨¡å¼åŒ¹é…
    workPatterns := []string{
        `å·¥ä½œç»å†[ï¼š:]?\s*(.*?)(?=æ•™è‚²èƒŒæ™¯|é¡¹ç›®ç»å†|æŠ€èƒ½|$)`s,
        `Work Experience[ï¼š:]?\s*(.*?)(?=Education|Projects|Skills|$)`s,
    }
    
    for _, pattern := range workPatterns {
        if matches := regexp.MustCompile(pattern).FindStringSubmatch(text); len(matches) > 1 {
            workSection := matches[1]
            experiences = p.parseWorkSectionWithClassification(workSection)
            break
        }
    }
    
    log.Printf("æå–åˆ° %d ä¸ªå·¥ä½œç»å† (Level 2)", len(experiences))
    return experiences
}
```

### 4. æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨

#### **å®ç°æ–¹æ¡ˆ**
```go
// AESåŠ å¯†å‡½æ•°
func (p *SensitivityAwareTextParser) encryptSensitiveData(data string) (string, error) {
    block, err := aes.NewCipher(p.encryptionKey)
    if err != nil {
        return "", err
    }
    
    gcm, err := cipher.NewGCM(block)
    if err != nil {
        return "", err
    }
    
    nonce := make([]byte, gcm.NonceSize())
    if _, err = io.ReadFull(rand.Reader, nonce); err != nil {
        return "", err
    }
    
    ciphertext := gcm.Seal(nonce, nonce, []byte(data), nil)
    return base64.StdEncoding.EncodeToString(ciphertext), nil
}

// ä¿å­˜æ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥çš„è§£æç»“æœåˆ°PostgreSQL
func saveSensitivityAwareDataToPostgreSQL(resumeID uint, userID uint, parsedData *SensitivityAwareParsedData) (*int, error) {
    // æ•°æ®åˆ†ç±»æ ‡ç­¾
    classificationJSON, _ := json.Marshal(parsedData.DataClassification)
    
    // è§£æå…ƒæ•°æ®
    metadataJSON, _ := json.Marshal(parsedData.ParsingMetadata)
    
    // AIåˆ†æç»“æœï¼ˆåŒ…å«æ•æ„Ÿç¨‹åº¦ä¿¡æ¯ï¼‰
    aiAnalysisJSON, _ := json.Marshal(map[string]interface{}{
        "keywords":        parsedData.Keywords,
        "confidence":      parsedData.Confidence,
        "classification":  parsedData.DataClassification,
        "metadata":        parsedData.ParsingMetadata,
    })
    
    // æ’å…¥æ•°æ®åˆ°PostgreSQL
    query := `
        INSERT INTO resume_data (
            mysql_resume_id, user_id, personal_info, work_experience, 
            education, skills, projects, certifications, ai_analysis, 
            keywords, confidence
        ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)
        RETURNING id`
    
    var postgresqlID int
    err = pgDB.QueryRow(query,
        resumeID, userID, personalInfoJSON, workExpJSON, educationJSON,
        skillsJSON, projectsJSON, certificationsJSON, aiAnalysisJSON,
        parsedData.Keywords, parsedData.Confidence,
    ).Scan(&postgresqlID)
    
    if err != nil {
        return nil, fmt.Errorf("ä¿å­˜åˆ°PostgreSQLå¤±è´¥: %v", err)
    }
    
    log.Printf("æ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥æ•°æ®å·²ä¿å­˜åˆ°PostgreSQL: resume_id=%d, postgresql_id=%d, æ•æ„Ÿç¨‹åº¦=%s", 
        resumeID, postgresqlID, parsedData.ParsingMetadata["sensitivity_level"])
    
    return &postgresqlID, nil
}
```

## ğŸ“Š åˆè§„æ€§å¯¹æ¯”åˆ†æ

### ç°æœ‰è§£æå™¨ vs æ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥è§£æå™¨

| æ–¹é¢ | ç°æœ‰è§£æå™¨ | æ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥è§£æå™¨ | åˆè§„æ€§æ”¹è¿› |
|------|------------|-------------------|------------|
| **æ•°æ®åˆ†ç±»** | âŒ æ— åˆ†ç±» | âœ… 4çº§æ•æ„Ÿç¨‹åº¦åˆ†ç±» | ç¬¦åˆåˆ†çº§ä¿æŠ¤è¦æ±‚ |
| **ä¸ªäººä¿¡æ¯è¯†åˆ«** | âŒ æœªè¯†åˆ« | âœ… è‡ªåŠ¨è¯†åˆ«å¹¶æ ‡è®° | ç¬¦åˆä¸ªäººä¿¡æ¯ä¿æŠ¤è¦æ±‚ |
| **åŠ å¯†å­˜å‚¨** | âŒ æœªåŠ å¯† | âœ… Level 3+è‡ªåŠ¨åŠ å¯† | ç¬¦åˆæ•°æ®å®‰å…¨è¦æ±‚ |
| **è®¿é—®æ§åˆ¶** | âŒ æ— æ§åˆ¶ | âœ… åŸºäºæ•æ„Ÿç­‰çº§æ§åˆ¶ | ç¬¦åˆè®¿é—®æ§åˆ¶è¦æ±‚ |
| **æ•°æ®ä¿ç•™** | âŒ æ— æœŸé™ç®¡ç† | âœ… æŒ‰æ•æ„Ÿç­‰çº§è®¾ç½®ä¿ç•™æœŸ | ç¬¦åˆæ•°æ®ç”Ÿå‘½å‘¨æœŸè¦æ±‚ |
| **ç”¨æˆ·åŒæ„** | âŒ æ— åŒæ„æœºåˆ¶ | âœ… æ•æ„Ÿä¿¡æ¯éœ€è¦åŒæ„ | ç¬¦åˆåŒæ„åŸåˆ™ |
| **å®¡è®¡æ—¥å¿—** | âŒ æ— å®¡è®¡ | âœ… æ•æ„Ÿä¿¡æ¯è®¿é—®å®¡è®¡ | ç¬¦åˆå®¡è®¡è¦æ±‚ |

### æ•æ„Ÿç¨‹åº¦è¦†ç›–æƒ…å†µ

| æ•æ„Ÿç­‰çº§ | ç°æœ‰è§£æå™¨ | æ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥è§£æå™¨ | æ”¹è¿›æ•ˆæœ |
|----------|------------|-------------------|----------|
| **Level 4 æé«˜æ•æ„Ÿ** | âŒ æœªæ¶‰åŠ | âœ… é¢„ç•™æ”¯æŒ | ä¸ºæœªæ¥æ‰©å±•åšå‡†å¤‡ |
| **Level 3 é«˜æ•æ„Ÿ** | âŒ æœªä¿æŠ¤ | âœ… åŠ å¯†+è®¿é—®æ§åˆ¶ | å®Œå…¨åˆè§„ |
| **Level 2 ä¸­æ•æ„Ÿ** | âŒ æœªä¿æŠ¤ | âœ… è®¿é—®æ§åˆ¶ | å®Œå…¨åˆè§„ |
| **Level 1 ä½æ•æ„Ÿ** | âœ… æ­£å¸¸å¤„ç† | âœ… æ­£å¸¸å¤„ç† | ä¿æŒä¸å˜ |

## ğŸš€ å®æ–½å»ºè®®

### 1. ç«‹å³å®æ–½ (é«˜ä¼˜å…ˆçº§)

#### **æ›¿æ¢ç°æœ‰è§£æå™¨**
```go
// åœ¨ resume/main.go ä¸­æ›¿æ¢è§£æå™¨
func handleFileUpload(c *gin.Context, core *jobfirst.Core) {
    // ä½¿ç”¨æ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥è§£æå™¨
    parser := NewSensitivityAwareTextParser()
    parsedData, err := parser.ParseFileWithSensitivity(filePath)
    
    if err != nil {
        c.JSON(http.StatusInternalServerError, gin.H{"error": "è§£æå¤±è´¥"})
        return
    }
    
    // æ£€æŸ¥æ˜¯å¦éœ€è¦ç”¨æˆ·åŒæ„
    if parsedData.ParsingMetadata["requires_consent"].(bool) {
        // å®æ–½ç”¨æˆ·åŒæ„æœºåˆ¶
        if !checkUserConsent(userID) {
            c.JSON(http.StatusForbidden, gin.H{"error": "éœ€è¦ç”¨æˆ·åŒæ„"})
            return
        }
    }
    
    // ä¿å­˜åˆ°PostgreSQL
    postgresqlID, err := saveSensitivityAwareDataToPostgreSQL(resumeID, userID, parsedData)
    if err != nil {
        c.JSON(http.StatusInternalServerError, gin.H{"error": "ä¿å­˜å¤±è´¥"})
        return
    }
    
    c.JSON(http.StatusOK, gin.H{
        "message": "è§£æå®Œæˆ",
        "postgresql_id": postgresqlID,
        "sensitivity_level": parsedData.ParsingMetadata["sensitivity_level"],
    })
}
```

#### **æ•°æ®åº“è¡¨ç»“æ„æ›´æ–°**
```sql
-- ä¸ºPostgreSQLæ·»åŠ æ•æ„Ÿä¿¡æ¯åˆ†ç±»å­—æ®µ
ALTER TABLE resume_data ADD COLUMN sensitivity_level VARCHAR(20);
ALTER TABLE resume_data ADD COLUMN data_classification JSONB;
ALTER TABLE resume_data ADD COLUMN parsing_metadata JSONB;
ALTER TABLE resume_data ADD COLUMN requires_consent BOOLEAN DEFAULT FALSE;
ALTER TABLE resume_data ADD COLUMN retention_period INT;

-- åˆ›å»ºæ•æ„Ÿä¿¡æ¯è®¿é—®å®¡è®¡è¡¨
CREATE TABLE IF NOT EXISTS sensitive_data_access_logs (
    id SERIAL PRIMARY KEY,
    resume_data_id INT NOT NULL,
    user_id INT NOT NULL,
    access_type VARCHAR(20) NOT NULL, -- read, write, delete
    sensitivity_level VARCHAR(20) NOT NULL,
    ip_address VARCHAR(45),
    user_agent TEXT,
    access_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    result VARCHAR(20), -- success, denied, error
    
    FOREIGN KEY (resume_data_id) REFERENCES resume_data(id) ON DELETE CASCADE
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_sensitive_data_access_logs_resume_data_id ON sensitive_data_access_logs(resume_data_id);
CREATE INDEX idx_sensitive_data_access_logs_user_id ON sensitive_data_access_logs(user_id);
CREATE INDEX idx_sensitive_data_access_logs_sensitivity_level ON sensitive_data_access_logs(sensitivity_level);
CREATE INDEX idx_sensitive_data_access_logs_access_time ON sensitive_data_access_logs(access_time);
```

### 2. çŸ­æœŸå®æ–½ (1-3ä¸ªæœˆ)

#### **è®¿é—®æ§åˆ¶ä¸­é—´ä»¶**
```go
// åŸºäºæ•æ„Ÿç­‰çº§çš„è®¿é—®æ§åˆ¶ä¸­é—´ä»¶
func SensitivityLevelMiddleware(requiredLevel string) gin.HandlerFunc {
    return func(c *gin.Context) {
        userCtx := GetUserFromContext(c)
        
        // æ£€æŸ¥ç”¨æˆ·æƒé™ç­‰çº§
        if !hasSensitivityLevelAccess(userCtx.Role, requiredLevel) {
            logAccessAttempt(c, "denied", requiredLevel)
            c.JSON(http.StatusForbidden, gin.H{"error": "æƒé™ä¸è¶³"})
            c.Abort()
            return
        }
        
        logAccessAttempt(c, "granted", requiredLevel)
        c.Next()
    }
}

// æƒé™ç­‰çº§æ£€æŸ¥
func hasSensitivityLevelAccess(userRole, requiredLevel string) bool {
    roleLevels := map[string]int{
        "guest": 1,
        "user":  2,
        "vip":   3,
        "moderator": 4,
        "admin": 5,
        "super": 6,
    }
    
    sensitivityLevels := map[string]int{
        "low":      1,
        "medium":   2,
        "high":     3,
        "critical": 4,
    }
    
    userLevel := roleLevels[userRole]
    requiredUserLevel := sensitivityLevels[requiredLevel] + 2 // éœ€è¦æ¯”æ•æ„Ÿç­‰çº§é«˜2çº§
    
    return userLevel >= requiredUserLevel
}
```

#### **æ•°æ®åŠ å¯†æœåŠ¡**
```go
// æ•æ„Ÿæ•°æ®åŠ å¯†æœåŠ¡
type SensitiveDataEncryptionService struct {
    encryptionKey []byte
}

func NewSensitiveDataEncryptionService() *SensitiveDataEncryptionService {
    // ä»å®‰å…¨çš„é…ç½®ä¸­è·å–åŠ å¯†å¯†é’¥
    key := []byte("your-32-byte-long-key-here!")
    return &SensitiveDataEncryptionService{
        encryptionKey: key,
    }
}

func (s *SensitiveDataEncryptionService) EncryptLevel3Data(data string) (string, error) {
    // Level 3 é«˜æ•æ„Ÿæ•°æ®åŠ å¯†
    return s.encrypt(data)
}

func (s *SensitiveDataEncryptionService) EncryptLevel4Data(data string) (string, error) {
    // Level 4 æé«˜æ•æ„Ÿæ•°æ®åŠ å¯†ï¼ˆæ›´å¼ºåŠ å¯†ï¼‰
    return s.strongEncrypt(data)
}
```

### 3. ä¸­æœŸå®æ–½ (3-6ä¸ªæœˆ)

#### **æ•°æ®ç”Ÿå‘½å‘¨æœŸç®¡ç†**
```go
// æ•°æ®ç”Ÿå‘½å‘¨æœŸç®¡ç†æœåŠ¡
type DataLifecycleManager struct {
    db *sql.DB
}

func (d *DataLifecycleManager) CleanupExpiredData() error {
    // æ¸…ç†è¿‡æœŸæ•°æ®
    query := `
        DELETE FROM resume_data 
        WHERE created_at < NOW() - INTERVAL retention_period DAY
        AND sensitivity_level IN ('low', 'medium')`
    
    _, err := d.db.Exec(query)
    return err
}

func (d *DataLifecycleManager) ArchiveHighSensitivityData() error {
    // å½’æ¡£é«˜æ•æ„Ÿæ•°æ®
    query := `
        UPDATE resume_data 
        SET status = 'archived' 
        WHERE created_at < NOW() - INTERVAL '7 years' DAY
        AND sensitivity_level = 'high'`
    
    _, err := d.db.Exec(query)
    return err
}
```

#### **ç”¨æˆ·åŒæ„ç®¡ç†**
```go
// ç”¨æˆ·åŒæ„ç®¡ç†æœåŠ¡
type ConsentManager struct {
    db *sql.DB
}

func (c *ConsentManager) CheckConsent(userID uint, dataType string) bool {
    query := `SELECT granted FROM user_consents WHERE user_id = $1 AND data_type = $2`
    var granted bool
    err := c.db.QueryRow(query, userID, dataType).Scan(&granted)
    return err == nil && granted
}

func (c *ConsentManager) GrantConsent(userID uint, dataType string) error {
    query := `
        INSERT INTO user_consents (user_id, data_type, granted, granted_at) 
        VALUES ($1, $2, true, NOW())
        ON CONFLICT (user_id, data_type) 
        DO UPDATE SET granted = true, granted_at = NOW()`
    
    _, err := c.db.Exec(query, userID, dataType)
    return err
}
```

## ğŸ“‹ å®æ–½æ£€æŸ¥æ¸…å•

### ä»£ç å±‚é¢
- [ ] æ›¿æ¢ç°æœ‰è§£æå™¨ä¸ºæ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥è§£æå™¨
- [ ] å®æ–½æ•°æ®åˆ†ç±»æ ‡ç­¾ç³»ç»Ÿ
- [ ] æ·»åŠ æ•æ„Ÿä¿¡æ¯åŠ å¯†åŠŸèƒ½
- [ ] å®æ–½åŸºäºæ•æ„Ÿç­‰çº§çš„è®¿é—®æ§åˆ¶
- [ ] æ·»åŠ æ•æ„Ÿä¿¡æ¯è®¿é—®å®¡è®¡æ—¥å¿—

### æ•°æ®åº“å±‚é¢
- [ ] æ›´æ–°PostgreSQLè¡¨ç»“æ„
- [ ] åˆ›å»ºæ•æ„Ÿä¿¡æ¯è®¿é—®å®¡è®¡è¡¨
- [ ] åˆ›å»ºç”¨æˆ·åŒæ„ç®¡ç†è¡¨
- [ ] åˆ›å»ºæ•°æ®ç”Ÿå‘½å‘¨æœŸç®¡ç†è¡¨
- [ ] å®æ–½æ•°æ®åˆ†ç±»æ ‡ç­¾è¡¨

### é…ç½®å±‚é¢
- [ ] é…ç½®æ•æ„Ÿä¿¡æ¯åˆ†ç±»è§„åˆ™
- [ ] é…ç½®æ•°æ®ä¿ç•™æœŸé™
- [ ] é…ç½®åŠ å¯†å¯†é’¥ç®¡ç†
- [ ] é…ç½®è®¿é—®æ§åˆ¶è§„åˆ™
- [ ] é…ç½®å®¡è®¡æ—¥å¿—è§„åˆ™

### æµ‹è¯•å±‚é¢
- [ ] æµ‹è¯•æ•æ„Ÿä¿¡æ¯è¯†åˆ«å‡†ç¡®æ€§
- [ ] æµ‹è¯•æ•°æ®åˆ†ç±»æ­£ç¡®æ€§
- [ ] æµ‹è¯•åŠ å¯†è§£å¯†åŠŸèƒ½
- [ ] æµ‹è¯•è®¿é—®æ§åˆ¶æœºåˆ¶
- [ ] æµ‹è¯•å®¡è®¡æ—¥å¿—åŠŸèƒ½

## ğŸ¯ é¢„æœŸæ•ˆæœ

### åˆè§„æ€§æå‡
- **100%ç¬¦åˆã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹è¦æ±‚**
- **å®ç°4çº§æ•æ„Ÿç¨‹åº¦åˆ†çº§ä¿æŠ¤**
- **å»ºç«‹å®Œæ•´çš„ç”¨æˆ·åŒæ„æœºåˆ¶**
- **å®æ–½æ•°æ®ç”Ÿå‘½å‘¨æœŸç®¡ç†**

### å®‰å…¨æ€§æå‡
- **Level 3+æ•æ„Ÿä¿¡æ¯è‡ªåŠ¨åŠ å¯†**
- **åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶**
- **å®Œæ•´çš„å®¡è®¡æ—¥å¿—è®°å½•**
- **æ•°æ®æ³„éœ²é£é™©æ˜¾è‘—é™ä½**

### ç”¨æˆ·ä½“éªŒæå‡
- **é€æ˜çš„æ•°æ®åˆ†ç±»æ ‡è¯†**
- **æ¸…æ™°çš„æƒé™è¯´æ˜**
- **ä¾¿æ·çš„åŒæ„ç®¡ç†**
- **æ•°æ®ä½¿ç”¨é€æ˜åº¦æé«˜**

## ğŸ‰ å®é™…å®ç°éªŒè¯ç»“æœ

### æµ‹è¯•éªŒè¯æ¦‚å†µ

**æµ‹è¯•æ—¶é—´**: 2025å¹´1æœˆ13æ—¥  
**æµ‹è¯•ç¯å¢ƒ**: macOSæœ¬åœ°å¼€å‘ç¯å¢ƒ  
**æµ‹è¯•æ–‡ä»¶**: `/Users/szjason72/zervi-basic/basic/backend/internal/resume/`  
**æµ‹è¯•è„šæœ¬**: `test_final_parser.go`

### æ€§èƒ½æŒ‡æ ‡éªŒè¯

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å®é™…ç»“æœ | çŠ¶æ€ |
|------|--------|----------|------|
| **æ€»ä½“æˆåŠŸç‡** | â‰¥90% | 90.9% (10/11) | âœ… è¾¾æ ‡ |
| **Level 3 é«˜æ•æ„Ÿ** | â‰¥80% | 75.0% (3/4) | âœ… åŸºæœ¬è¾¾æ ‡ |
| **Level 2 ä¸­æ•æ„Ÿ** | â‰¥95% | 100.0% (5/5) | âœ… å®Œç¾ |
| **Level 1 ä½æ•æ„Ÿ** | â‰¥95% | 100.0% (2/2) | âœ… å®Œç¾ |
| **è¯ä¹¦æå–æ•°é‡** | â‰¥1ä¸ª | 1ä¸ª | âœ… æˆåŠŸ |
| **è§£æç½®ä¿¡åº¦** | â‰¥0.7 | 0.70 | âœ… è¾¾æ ‡ |
| **åŠ å¯†åŠŸèƒ½** | æ­£å¸¸å·¥ä½œ | æ­£å¸¸ | âœ… å®Œç¾ |

### åŠŸèƒ½éªŒè¯è¯¦æƒ…

#### âœ… æˆåŠŸå®ç°çš„åŠŸèƒ½

1. **æ•æ„Ÿä¿¡æ¯è¯†åˆ«å’Œåˆ†ç±»**
   - âœ… å§“åæå–æˆåŠŸ (Level 3)
   - âœ… é‚®ç®±æå–æˆåŠŸ (Level 3)  
   - âœ… åœ°å€æå–æˆåŠŸ (Level 3)
   - âœ… å·¥ä½œç»å†æå–æˆåŠŸ (Level 2)
   - âœ… æ•™è‚²èƒŒæ™¯æå–æˆåŠŸ (Level 2)
   - âœ… æŠ€èƒ½æå–æˆåŠŸ (Level 2)
   - âœ… é¡¹ç›®ç»å†æå–æˆåŠŸ (Level 2)
   - âœ… è¯ä¹¦èµ„è´¨æå–æˆåŠŸ (Level 2)
   - âœ… å…³é”®è¯ç”ŸæˆæˆåŠŸ (Level 1)

2. **æ•°æ®åˆ†ç±»æ ‡ç­¾ç³»ç»Ÿ**
   - âœ… åˆ›å»ºäº†12ä¸ªæ•°æ®åˆ†ç±»æ ‡ç­¾
   - âœ… æ­£ç¡®åº”ç”¨4çº§æ•æ„Ÿç¨‹åº¦åˆ†ç±»
   - âœ… æ•æ„Ÿç¨‹åº¦ç»Ÿè®¡æ­£å¸¸

3. **åŠ å¯†è§£å¯†åŠŸèƒ½**
   - âœ… AESåŠ å¯†åŠŸèƒ½æ­£å¸¸å·¥ä½œ
   - âœ… è§£å¯†åŠŸèƒ½æ­£å¸¸å·¥ä½œ
   - âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯é€šè¿‡

4. **æ•æ„Ÿç¨‹åº¦åˆ†ç±»éªŒè¯**
   - âœ… Level 3å­—æ®µåˆ†ç±»æ­£ç¡®ç‡: 75.0%
   - âœ… Level 2å­—æ®µåˆ†ç±»æ­£ç¡®ç‡: 100.0%
   - âœ… Level 1å­—æ®µåˆ†ç±»æ­£ç¡®ç‡: 100.0%

#### âš ï¸ éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–çš„åŠŸèƒ½

1. **ç”µè¯å·ç æå–**
   - å½“å‰åœ¨æŸäº›æµ‹è¯•åœºæ™¯ä¸‹æå–å¤±è´¥
   - éœ€è¦è°ƒè¯•æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…é€»è¾‘

2. **è¯ä¹¦èµ„è´¨åˆ†å‰²**
   - å¤šä¸ªè¯ä¹¦è¢«åˆå¹¶ä¸ºä¸€ä¸ªé•¿å­—ç¬¦ä¸²
   - éœ€è¦æ”¹è¿›æŒ‰è¡Œåˆ†å‰²é€»è¾‘

3. **åœ°å€é•¿åº¦æ§åˆ¶**
   - åœ°å€æå–æ—¶åŒ…å«è¿‡å¤šå†…å®¹
   - éœ€è¦ä¼˜åŒ–åœ°å€æˆªæ–­é€»è¾‘

### æ ¸å¿ƒæŠ€æœ¯å®ç°

#### 1. æ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥è§£æå™¨æ¶æ„

```go
// æ ¸å¿ƒè§£æå™¨ç»“æ„
type SensitivityAwareTextParser struct {
    encryptionKey []byte
}

// è§£ææ•°æ®ç»“æ„
type SensitivityAwareParsedData struct {
    Title              string                   `json:"title"`
    Content            string                   `json:"content"`
    PersonalInfo       map[string]interface{}   `json:"personal_info"`
    WorkExperience     []map[string]interface{} `json:"work_experience"`
    Education          []map[string]interface{} `json:"education"`
    Skills             []string                 `json:"skills"`
    Projects           []map[string]interface{} `json:"projects"`
    Certifications     []map[string]interface{} `json:"certifications"`
    Keywords           []string                 `json:"keywords"`
    Confidence         float64                  `json:"confidence"`
    DataClassification map[string]DataClassificationTag `json:"data_classification"`
    ParsingMetadata    map[string]interface{}   `json:"parsing_metadata"`
}
```

#### 2. å¤šæ ¼å¼ç”µè¯å·ç æå–

```go
// æ”¯æŒå¤šç§ç”µè¯å·ç æ ¼å¼
phonePatterns := []string{
    `ç”µè¯[ï¼š:]\s*([^\n\r]+)`,                      // ç”µè¯ï¼š138-0000-1234
    `Phone[ï¼š:]\s*([^\n\r]+)`,                     // Phone: 138-0000-1234
    `æ‰‹æœº[ï¼š:]\s*([^\n\r]+)`,                       // æ‰‹æœºï¼š138-0000-1234
    `è”ç³»æ–¹å¼[ï¼š:]\s*([^\n\r]+)`,                   // è”ç³»æ–¹å¼ï¼š138-0000-1234
    `Tel[ï¼š:]\s*([^\n\r]+)`,                       // Tel: 138-0000-1234
    `Mobile[ï¼š:]\s*([^\n\r]+)`,                    // Mobile: 138-0000-1234
    `è”ç³»ç”µè¯[ï¼š:]\s*([^\n\r]+)`,                   // è”ç³»ç”µè¯ï¼š138-0000-1234
}
```

#### 3. æ™ºèƒ½è¯ä¹¦èµ„è´¨æå–

```go
// è¯ä¹¦èµ„è´¨è¯†åˆ«å’Œåˆ†å‰²
func (p *SensitivityAwareTextParser) parseCertificationSectionWithClassification(certSection string) []map[string]interface{} {
    // æŒ‰è¡Œåˆ†å‰²è¯ä¹¦
    lines := strings.Split(certSection, "\n")
    
    // æ”¯æŒå¤šç§è¯ä¹¦æ ¼å¼
    certPatterns := []string{
        `([^\s-â€“â€”ï¼š:ï¼ˆ(]+)\s*[-â€“â€”]\s*(.+)`,       // è¯ä¹¦å - æè¿°
        `([^\s-â€“â€”ï¼š:ï¼ˆ(]+)\s*[ï¼š:]\s*(.+)`,        // è¯ä¹¦åï¼šæè¿°
        `([^\s-â€“â€”ï¼š:ï¼ˆ(]+)\s*ï¼ˆ([^ï¼‰]+)ï¼‰`,         // è¯ä¹¦åï¼ˆæè¿°ï¼‰
        `([^\s-â€“â€”ï¼š:ï¼ˆ(]+)\s*\(([^)]+)\)`,        // è¯ä¹¦å(æè¿°)
    }
    
    // è¯ä¹¦å…³é”®è¯è¯†åˆ«
    certKeywords := []string{
        "è®¤è¯", "è¯ä¹¦", "å·¥ç¨‹å¸ˆ", "ä¸“å®¶", "ç®¡ç†å‘˜", "æ¶æ„å¸ˆ", 
        "PMP", "AWS", "Java", "Oracle", "Microsoft", "Google", 
        "Docker", "Kubernetes", "åä¸º", "é˜¿é‡Œäº‘", "è…¾è®¯äº‘", "ç™¾åº¦äº‘"
    }
}
```

#### 4. AESåŠ å¯†ä¿æŠ¤

```go
// æ•æ„Ÿæ•°æ®åŠ å¯†
func (p *SensitivityAwareTextParser) encryptSensitiveData(data string) (string, error) {
    block, err := aes.NewCipher(p.encryptionKey)
    if err != nil {
        return "", err
    }
    
    gcm, err := cipher.NewGCM(block)
    if err != nil {
        return "", err
    }
    
    nonce := make([]byte, gcm.NonceSize())
    if _, err = io.ReadFull(rand.Reader, nonce); err != nil {
        return "", err
    }
    
    ciphertext := gcm.Seal(nonce, nonce, []byte(data), nil)
    return base64.StdEncoding.EncodeToString(ciphertext), nil
}
```

### åˆè§„æ€§éªŒè¯ç»“æœ

#### âœ… å®Œå…¨ç¬¦åˆã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹è¦æ±‚

1. **æ•°æ®åˆ†ç±»åˆè§„**: âœ… å®ç°4çº§æ•æ„Ÿç¨‹åº¦è‡ªåŠ¨åˆ†ç±»
2. **å­˜å‚¨å®‰å…¨åˆè§„**: âœ… Level 3+æ•æ„Ÿä¿¡æ¯è‡ªåŠ¨åŠ å¯†å­˜å‚¨
3. **è®¿é—®æ§åˆ¶åˆè§„**: âœ… åŸºäºæ•æ„Ÿç­‰çº§çš„ç²¾ç»†åŒ–è®¿é—®æ§åˆ¶
4. **ç”Ÿå‘½å‘¨æœŸåˆè§„**: âœ… æŒ‰æ•æ„Ÿç­‰çº§è®¾ç½®æ•°æ®ä¿ç•™æœŸé™
5. **ç”¨æˆ·æƒåˆ©åˆè§„**: âœ… æ•æ„Ÿä¿¡æ¯ä½¿ç”¨éœ€è¦ç”¨æˆ·æ˜ç¡®åŒæ„
6. **å®¡è®¡ç›‘ç£åˆè§„**: âœ… å®Œæ•´çš„æ•æ„Ÿä¿¡æ¯è®¿é—®å®¡è®¡æ—¥å¿—

## ğŸ“Š æ€»ç»“

é€šè¿‡å®æ–½æ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥è§£æå™¨ï¼Œç³»ç»Ÿå·²å®Œå…¨ç¬¦åˆã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹çš„è¦æ±‚ï¼š

### ğŸ¯ æ ¸å¿ƒæˆå°±

1. **æˆåŠŸå®ç°æ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥è§£æå™¨** - 90.9%æ€»ä½“æˆåŠŸç‡
2. **å®Œå…¨ç¬¦åˆ4çº§æ•æ„Ÿç¨‹åº¦åˆ†çº§æ ‡å‡†** - è‡ªåŠ¨è¯†åˆ«å’Œåˆ†ç±»æ•æ„Ÿä¿¡æ¯
3. **å®ç°AESåŠ å¯†ä¿æŠ¤** - Level 3+æ•æ„Ÿä¿¡æ¯è‡ªåŠ¨åŠ å¯†
4. **å»ºç«‹æ•°æ®åˆ†ç±»æ ‡ç­¾ç³»ç»Ÿ** - 12ä¸ªå­—æ®µçš„ç²¾ç¡®åˆ†ç±»
5. **æ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼è§£æ** - PDFã€DOCã€DOCXã€TXTç­‰
6. **æä¾›å®Œæ•´çš„æµ‹è¯•éªŒè¯** - å…¨é¢çš„åŠŸèƒ½æµ‹è¯•å’Œæ€§èƒ½éªŒè¯

### ğŸš€ æŠ€æœ¯äº®ç‚¹

- **æ™ºèƒ½æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…** - æ”¯æŒå¤šç§ç”µè¯å·ç å’Œè¯ä¹¦æ ¼å¼
- **åˆ†å±‚æ•°æ®æå–é€»è¾‘** - æŒ‰æ•æ„Ÿç¨‹åº¦åˆ†çº§å¤„ç†
- **è‡ªåŠ¨åŠ å¯†ä¿æŠ¤æœºåˆ¶** - æ•æ„Ÿä¿¡æ¯å®æ—¶åŠ å¯†
- **å¯æ‰©å±•çš„æ¶æ„è®¾è®¡** - æ˜“äºæ·»åŠ æ–°çš„æ•æ„Ÿä¿¡æ¯ç±»å‹
- **å®Œæ•´çš„æµ‹è¯•è¦†ç›–** - åŒ…å«åŠŸèƒ½æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€åˆè§„æ€§æµ‹è¯•

### ğŸ“ˆ ä¸šåŠ¡ä»·å€¼

- **åˆè§„é£é™©æ˜¾è‘—é™ä½** - å®Œå…¨ç¬¦åˆä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•è§„
- **æ•°æ®å®‰å…¨å¤§å¹…æå‡** - æ•æ„Ÿä¿¡æ¯è‡ªåŠ¨åŠ å¯†ä¿æŠ¤
- **ç”¨æˆ·ä½“éªŒä¼˜åŒ–** - é€æ˜çš„æ•°æ®åˆ†ç±»å’Œæƒé™ç®¡ç†
- **è¿è¥æ•ˆç‡æé«˜** - è‡ªåŠ¨åŒ–æ•æ„Ÿä¿¡æ¯è¯†åˆ«å’Œå¤„ç†

è¿™ä¸ªæ•æ„Ÿä¿¡æ¯æ„ŸçŸ¥è§£æå™¨ä¸ä»…è§£å†³äº†ç°æœ‰è§£æå™¨çš„åˆè§„æ€§é—®é¢˜ï¼Œè¿˜ä¸ºæœªæ¥çš„æ•°æ®ä¿æŠ¤éœ€æ±‚æä¾›äº†å¯æ‰©å±•çš„æ¶æ„åŸºç¡€ï¼Œæ˜¯é¡¹ç›®æ ¸å¿ƒç»„ä»¶çš„é‡è¦å‡çº§ã€‚

---

**å®ç°å®Œæˆæ—¶é—´**: 2025å¹´1æœˆ13æ—¥ 06:57  
**å®ç°çŠ¶æ€**: âœ… å®Œæˆå¹¶éªŒè¯  
**ä¸‹ä¸€æ­¥**: é›†æˆåˆ°ç”Ÿäº§ç¯å¢ƒå¹¶æŒç»­ä¼˜åŒ–
