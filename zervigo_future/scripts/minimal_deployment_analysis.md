# 阿里云Docker部署必要服务分析

## 🎯 部署目的
- 测试ZerviGo子系统节点
- 验证与腾讯云LoomaCRM的auth服务
- 确保数据一致性校验

## ✅ 必须部署的服务 (跨云集成测试核心)

### 🔐 认证和授权服务
1. **basic-server (8080)** - 核心认证服务
   - JWT令牌管理
   - 用户认证API (`/auth/login`, `/auth/register`)
   - 跨云认证验证
   - 健康检查端点 (`/health`)

### 🗄️ 数据存储服务
2. **mysql** - 用户数据和认证信息
   - 用户表 (users)
   - 认证令牌表
   - 会话管理表

3. **redis** - 会话缓存和令牌存储
   - JWT令牌缓存
   - 会话状态管理
   - 临时数据存储

### 🔍 服务发现
4. **consul** - 跨云服务注册和发现
   - 服务注册
   - 健康检查
   - 跨云服务发现

## ❌ 非必要服务 (可以暂时不部署)

### 📝 业务功能服务
1. **user-service (8081)** - 用户管理
   - 非核心认证功能
   - 可以后续添加

2. **resume-service (8082)** - 简历管理
   - 非认证相关
   - 业务功能，非测试必需

3. **template-service (8085)** - 模板服务
   - 非认证测试必需

4. **statistics-service (8086)** - 统计服务
   - 非认证测试必需

5. **banner-service (8087)** - 横幅服务
   - 非认证测试必需

### 🤖 AI服务
6. **容器化AI服务** - 非认证测试必需
7. **本地化AI服务** - 非认证测试必需

## 🚀 精简部署方案

### 最小化部署包
```
deployment-package/
├── basic-server/           # 核心认证服务
│   ├── basic-server        # 编译后的二进制文件
│   └── config/            # 配置文件
├── consul/                # 服务发现
│   └── consul             # Consul二进制
├── mysql/                 # 数据库
│   └── init.sql          # 初始化脚本
├── redis/                 # 缓存服务
│   └── redis.conf        # Redis配置
└── deploy.sh             # 部署脚本
```

### 部署脚本重点
1. 启动MySQL和Redis
2. 启动Consul
3. 启动basic-server
4. 验证服务健康状态
5. 测试跨云连接

## 📊 资源优化效果

### 部署包大小减少
- 移除AI服务: ~2GB
- 移除业务服务: ~500MB
- 移除前端资源: ~200MB
- **总计减少: ~2.7GB**

### 启动时间优化
- 减少服务数量: 8个 → 4个
- 减少依赖关系: 简化启动顺序
- 减少资源占用: CPU/内存使用降低

### 测试专注度
- 专注于认证服务测试
- 减少干扰因素
- 提高测试效率

## 🔧 实施建议

1. **第一阶段**: 部署最小化服务包
2. **第二阶段**: 验证跨云认证功能
3. **第三阶段**: 根据需要逐步添加其他服务

## 📋 验证清单

- [ ] basic-server健康检查通过
- [ ] MySQL连接正常
- [ ] Redis连接正常
- [ ] Consul服务注册成功
- [ ] 跨云认证API可访问
- [ ] JWT令牌生成和验证正常
